---
import type { GetProductsQuery } from "api.generated";
import { request } from "graphql-request";
import ProductImage from "@/components/ProductImage";
import ProductPrice from "@/components/ProductPrice";
import getProducts from "@/graphql/products.gql";

interface Props {
  showButton?: true;
  first?: number;
  t?: (key: string) => string;
};

const { showButton, first, t } = Astro.props;

const {
  products: { nodes: products },
} = await request<GetProductsQuery>("https://mock.shop/api", getProducts, {
  first,
});
---

<section class="my-8 flex flex-col gap-5">
  <h2 class="text-2xl">You may also like</h2>
  <ul class="grid grid-cols-2 gap-6 md:grid-cols-4">
    {
      products.map(
        ({
          featuredImage,
          title,
          variants: {
            nodes: [
              {
                price: { amount, currencyCode },
              },
            ],
          },
        }) => (
          <li>
            <ProductImage src={featuredImage!.url as string} alt={title} />
            <h3>{title}</h3>
            <ProductPrice amount={amount as string} currency={currencyCode} />
          </li>
        )
      )
    }
  </ul>
  {
    showButton && (
      <div class="mt-5 flex flex-col items-center">
        <a
          class="bg-primary px-8 py-3 text-primary-contrast hover:outline-1 hover:outline-primary hover:outline-solid"
          href="/collections/all"
        >
          {t('View all')}
        </a>
      </div>
    )
  }
</section>
